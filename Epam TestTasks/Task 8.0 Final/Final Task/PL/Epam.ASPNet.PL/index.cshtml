@using Epam.CommonLoggerInterface;
@using Epam.DependencyResolver;
@using Epam.ASPNet.PL.Models;
@using Epam.Interfaces.BLL;
@using Epam.ASPNet.PL.Models;

@{
    Resolver resolver = CommonData.GetResolver();
    IUsersBLL bloUsers = resolver.GetBloUsers;
    ILogger logger = resolver.GetLogger;
    string fspath = Server.MapPath("");
    bloUsers.SetPath(fspath);


    if (User.Identity.IsAuthenticated)
    {
        if (CommonData.CurrentUser == null)
        {
            logger.Info("PL/index: creating new user object");
            CommonData.CurrentUser = bloUsers.GetByEmail(User.Identity.Name);
        }

        Page.idUser = CommonData.CurrentUser.id;
        @RenderPage("~/Pages/userPage.cshtml");
    }
    else
    {
        logger.Info("PL/index: user not authentificated, redirecting to auth page");
        Response.Redirect("~/Pages/authPage.cshtml");
    }
}
