@* Модель регистрации нового пользователя *@

@using Epam.ASPNet.PL.Models
@using Epam.DependencyResolver

@{
    if (IsPost)
    {
        try
        {
            string name = Request["name"];
            string login = Request["email"];
            string password = Request["password"];
            DateTime date = DateTime.Parse(Request["date"]);

            Resolver resolver = CommonData.GetResolver();

            if (resolver.GetBloUsers.Create(login, password, name, date))
            {
                Response.Redirect("~/Pages/authPage.cshtml");
            }
            else
            {
                CommonData.authError = true;
                Response.Redirect("~/Pages/regPage.cshtml");
            }
        }
        catch (Exception e)
        {   // Перехват сгенерированой в blo ошибки регистрации и ошибки которая может возникнуть при parse даты

            Page.Exception = e;
            @RenderPage("~/Pages/errorPage.cshtml");
        }
    }
}